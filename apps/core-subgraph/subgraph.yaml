specVersion: 0.0.4
description: TempleDAO Core Subgraph
features:
  - grafting
repository: https://github.com/TempleDAO/templedao-core-subgraph
schema:
  file: ./schema.graphql
dataSources:
  # Ops Manager
  - kind: ethereum/contract
    name: OpsManager
    network: mainnet
    source:
      address: '0x2e2ed0cfd3ad2f1d34481277b3204d807ca2f8c2'
      abi: OpsManager
      startBlock: 1
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/opsManager.ts
      entities:
        - OpsManager
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: CreateExposure(address,address)
          handler: onCreateExposure
        - event: CreateVault(address)
          handler: onCreateVault
templates:
  # Exposures
  - kind: ethereum/contract
    name: Exposure
    network: mainnet
    source:
      abi: Exposure
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/exposure.ts
      entities:
        - Exposure
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: IncreaseReval(uint256,uint256)
          handler: onIncreaseReval
        - event: DecreaseReval(uint256,uint256)
          handler: onDecreaseReval
        - event: SetLiquidator(address)
          handler: onSetLiquidator
        - event: SetMinterState(address,bool)
          handler: onSetMinterState
        - event: Redeem(address,address,uint256)
          handler: onRedeem
  # Treasury Farming Revenues
  - kind: ethereum/contract
    name: TreasuryFarmingRevenue
    network: mainnet
    source:
      abi: TreasuryFarmingRevenue
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/treasuryFarmingRevenue.ts
      entities:
        - TreasuryFarmingRevenue
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: IncreaseShares(address,uint256)
          handler: onIncreaseShares
        - event: DecreaseShares(address,uint256)
          handler: onDecreaseShares
        - event: RevenueEarned(uint256,uint256)
          handler: onRevenueEarned
        - event: RevenueClaimed(address,uint256)
          handler: onRevenueClaimed
  # Vaults
  - kind: ethereum/contract
    name: Vault
    network: mainnet
    source:
      abi: Vault
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/vault.ts
      entities:
        - Vault
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: Deposit(address,uint256)
          handler: onDeposit
        - event: Withdraw(address,uint256)
          handler: onWithdraw
