specVersion: 0.0.4
description: TempleDAO Core Subgraph
features:
  - grafting
repository: https://github.com/TempleDAO/templedao-core-subgraph
schema:
  file: ./schema.graphql
dataSources:
  # Ops Manager
  - kind: ethereum/contract
    name: OpsManager
    network: rinkeby
    source:
      address: '0xf7D5a97B122dd7D5366045DE76d4791Ac5428da5'
      abi: OpsManager
      startBlock: 10631173
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/opsManager.ts
      entities:
        - OpsManager
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: CreateExposure(address,address)
          handler: onCreateExposure
        - event: CreateVaultInstance(address)
          handler: onCreateVaultInstance
  # Access Controlled Offchain Aggregator
  - kind: ethereum/contract
    name: HourlyScheduler
    network: rinkeby
    source:
      address: '0x28D757e89e38Ee5eEfF3eaB330Ad1AB99DD7c9eb'
      abi: OffchainAggregator
      startBlock: 10631173
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/hourlyScheduler.ts
      entities:
        - HourlyScheduler
      abis:
        - name: OffchainAggregator
          file: ./abis/OffchainAggregator.json
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: AnswerUpdated(indexed int256,indexed uint256,uint256)
          handler: onAnswerUpdated
templates:
  # Exposures
  - kind: ethereum/contract
    name: Exposure
    network: rinkeby
    source:
      abi: Exposure
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/exposure.ts
      entities:
        - Exposure
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: IncreaseReval(uint256,uint256)
          handler: onIncreaseReval
        - event: DecreaseReval(uint256,uint256)
          handler: onDecreaseReval
        - event: SetLiquidator(address)
          handler: onSetLiquidator
        - event: SetMinterState(address,bool)
          handler: onSetMinterState
        - event: Redeem(address,address,uint256)
          handler: onRedeem
  # Treasury Farming Revenues
  - kind: ethereum/contract
    name: TreasuryFarmingRevenue
    network: rinkeby
    source:
      abi: TreasuryFarmingRevenue
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/treasuryFarmingRevenue.ts
      entities:
        - TreasuryFarmingRevenue
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: IncreaseShares(address,uint256)
          handler: onIncreaseShares
        - event: DecreaseShares(address,uint256)
          handler: onDecreaseShares
        - event: RevenueEarned(uint256,uint256)
          handler: onRevenueEarned
        - event: RevenueClaimed(address,uint256)
          handler: onRevenueClaimed
  # Vaults
  - kind: ethereum/contract
    name: Vault
    network: rinkeby
    source:
      abi: Vault
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/vault.ts
      entities:
        - Vault
      abis:
        - name: OpsManager
          file: ./abis/OpsManager.json
        - name: Exposure
          file: ./abis/Exposure.json
        - name: JoiningFee
          file: ./abis/JoiningFee.json
        - name: RebasingERC20
          file: ./abis/RebasingERC20.json
        - name: TreasuryFarmingRevenue
          file: ./abis/TreasuryFarmingRevenue.json
        - name: Vault
          file: ./abis/Vault.json
      eventHandlers:
        - event: Deposit(address,uint256,uint256)
          handler: onDeposit
        - event: Withdraw(address,uint256)
          handler: onWithdraw
